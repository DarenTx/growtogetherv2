<!-- ── Enter Historical Data (Admin) ───────────────────────────────── -->
<div class="gt-page">
  @if (loadingProfiles()) {
    <p class="gt-loading" role="status" aria-live="polite">Loading profiles…</p>
  }
  @if (profileLoadError()) {
    <div class="gt-banner gt-banner-error" role="alert">{{ profileLoadError() }}</div>
  }

  <h1 class="gt-page-title">Enter Historical Data</h1>

  <div class="gt-card">
    <form
      [formGroup]="form"
      (ngSubmit)="onSubmit()"
      novalidate
      aria-label="Enter historical data form"
      class="gt-form"
    >
      <div class="gt-field">
        <label class="gt-label" for="profile_id">Profile</label>
        <select
          id="profile_id"
          formControlName="profile_id"
          aria-required="true"
          (change)="onProfileChange($event)"
          class="gt-select"
          [attr.aria-invalid]="form.controls.profile_id.invalid && form.controls.profile_id.touched"
        >
          <option value="" disabled>Select a profile…</option>
          @for (p of profiles(); track p.id) {
            <option [value]="p.id">{{ p.first_name }} {{ p.last_name }} — {{ p.email }}</option>
          }
        </select>
        @if (form.controls.profile_id.invalid && form.controls.profile_id.touched) {
          <p class="gt-field-error" role="alert">Please select a profile.</p>
        }
      </div>

      <div class="gt-field">
        <label class="gt-label" for="year_hist">Year</label>
        <input
          id="year_hist"
          type="number"
          formControlName="year"
          min="2001"
          max="2100"
          aria-required="true"
          class="gt-input"
          [attr.aria-invalid]="form.controls.year.invalid && form.controls.year.touched"
        />
        @if (form.controls.year.invalid && form.controls.year.touched) {
          <p class="gt-field-error" role="alert">Year must be between 2001 and 2100.</p>
        }
      </div>

      <div class="gt-field">
        <label class="gt-label" for="month_hist">Month</label>
        <input
          id="month_hist"
          type="number"
          formControlName="month"
          min="1"
          max="12"
          aria-required="true"
          class="gt-input"
          [attr.aria-invalid]="form.controls.month.invalid && form.controls.month.touched"
        />
        @if (form.controls.month.invalid && form.controls.month.touched) {
          <p class="gt-field-error" role="alert">Month must be between 1 and 12.</p>
        }
      </div>

      <div class="gt-field">
        <label class="gt-label" for="bank_name">Bank Name</label>
        <select id="bank_name" formControlName="bank_name" aria-required="true" class="gt-select">
          @for (opt of bankOptions; track opt) {
            <option [value]="opt">{{ opt }}</option>
          }
        </select>
      </div>

      <div class="gt-checkbox-row">
        <input id="is_managed" type="checkbox" formControlName="is_managed" />
        <label for="is_managed">Is Managed</label>
      </div>

      <div class="gt-field">
        <label class="gt-label" for="growth_pct_hist">Growth %</label>
        <input
          id="growth_pct_hist"
          type="number"
          formControlName="growth_pct"
          step="0.01"
          placeholder="e.g. 7.43"
          aria-required="true"
          class="gt-input"
          [attr.aria-invalid]="form.controls.growth_pct.invalid && form.controls.growth_pct.touched"
        />
        @if (form.controls.growth_pct.invalid && form.controls.growth_pct.touched) {
          <p class="gt-field-error" role="alert">A valid growth percent is required.</p>
        }
      </div>

      @if (successMessage()) {
        <div class="gt-banner gt-banner-success" role="status">{{ successMessage() }}</div>
      }
      @if (errorMessage()) {
        <div class="gt-banner gt-banner-error" role="alert">{{ errorMessage() }}</div>
      }

      <div class="gt-btn-row">
        <button type="submit" class="gt-btn gt-btn-primary" [disabled]="isSubmitting()">
          {{ isSubmitting() ? 'Saving…' : 'Save' }}
        </button>
        <button type="button" class="gt-btn gt-btn-ghost" (click)="clearAll()">Clear All</button>
      </div>
    </form>
  </div>

  @if (showGrowthData()) {
    <h2 class="gt-section-title">
      Growth Data — {{ selectedProfile()!.first_name }} {{ selectedProfile()!.last_name }}
    </h2>

    @if (growthData().length === 0) {
      <p class="gt-empty">No growth data found for this profile.</p>
    } @else {
      <div class="gt-list">
        <div class="gt-list-header">
          <span>Yr-Mo</span>
          <span>Bank</span>
          <span>Managed</span>
          <span>Growth %</span>
        </div>
        @for (g of growthData(); track g.id) {
          <div class="gt-list-row">
            <span>{{ g.year }}-{{ g.month }}</span>
            <span>{{ g.bank_name }}</span>
            <span>{{ g.is_managed ? 'Yes' : 'No' }}</span>
            <span>{{ g.growth_pct }}%</span>
          </div>
        }
      </div>
    }
  }
</div>
